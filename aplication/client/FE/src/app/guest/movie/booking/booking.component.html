<div id="page" class="hfeed site">
  <app-header></app-header>
  <div id="main">
    <div class="steps-booking">
      <div class="steps choose-chair active-step" data-id="1">
        <i class="fa-solid fa-table-cells-large"></i>
        <p>Chọn ghế</p>
      </div>
      <div class="steps water-corn" data-id="2">
        <i class="fa-solid fa-bag-shopping"></i>
        <p>Chọn đồ ăn</p>
      </div>
      <div class="steps payment-st" data-id="3">
        <i class="fa-regular fa-credit-card"></i>
        <p>Thanh toán</p>
      </div>
      <div class="steps st-info" data-id="4">
        <i class="fa-solid fa-info"></i>
        <p>Thông tin vé</p>
      </div>
    </div>
    <div class="wrapper booking-main">
      <div class="col-md-8">
        <!-- /Book chair -->
        <div class="booking-chair">
          <div class="note">
            <div class="row-book row">
              <div class="single">
                <span></span>
                <p>Ghế đơn</p>
              </div>
              <div class="choice">
                <span></span>
                <p>Ghế chọn</p>
              </div>
              <div class="sold">
                <span></span>
                <p>Ghế đã bán</p>
              </div>
            </div>

          </div>
          <div class="row-book">
            <div class="screen">Màn hình</div>
          </div>
          <div class="chair">
            <div>
              <div class="row-book" *ngFor="let seat of showSeat; let i = index">
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[0].id) ,'active-seat': checkActive(seat[0].id)}"
                  (click)="addSeat($event.target,seat[0].id,seat[0].name)">{{seat[0].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[1].id) , 'active-seat': checkActive(seat[1].id) }"
                  (click)="addSeat($event.target,seat[1].id,seat[1].name)">{{seat[1].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[2].id) , 'active-seat': checkActive(seat[2].id) }"
                  (click)="addSeat($event.target,seat[2].id,seat[2].name)">{{seat[2].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[3].id) , 'active-seat': checkActive(seat[3].id) }"
                  (click)="addSeat($event.target,seat[3].id,seat[3].name)">{{seat[3].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[4].id) , 'active-seat': checkActive(seat[4].id) }"
                  (click)="addSeat($event.target,seat[4].id,seat[4].name)">{{seat[4].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[5].id) , 'active-seat': checkActive(seat[5].id) }"
                  (click)="addSeat($event.target,seat[5].id,seat[5].name)">{{seat[5].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[6].id) , 'active-seat': checkActive(seat[6].id) }"
                  (click)="addSeat($event.target,seat[6].id,seat[6].name)">{{seat[6].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[7].id) , 'active-seat': checkActive(seat[7].id) }"
                  (click)="addSeat($event.target,seat[7].id,seat[7].name)">{{seat[7].name}}</div>
                <div class="land"></div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[8].id) , 'active-seat': checkActive(seat[8].id) }"
                  (click)="addSeat($event.target,seat[8].id,seat[8].name)">{{seat[8].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[9].id) , 'active-seat': checkActive(seat[9].id) }"
                  (click)="addSeat($event.target,seat[9].id,seat[9].name)">{{seat[9].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[10].id) , 'active-seat': checkActive(seat[10].id) }"
                  (click)="addSeat($event.target,seat[10].id,seat[10].name)">{{seat[10].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[11].id) , 'active-seat': checkActive(seat[11].id) }"
                  (click)="addSeat($event.target,seat[11].id,seat[11].name)">{{seat[11].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[12].id) , 'active-seat': checkActive(seat[12].id) }"
                  (click)="addSeat($event.target,seat[12].id,seat[12].name)">{{seat[12].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[13].id) , 'active-seat': checkActive(seat[13].id) }"
                  (click)="addSeat($event.target,seat[13].id,seat[13].name)">{{seat[13].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[14].id) , 'active-seat': checkActive(seat[14].id) }"
                  (click)="addSeat($event.target,seat[14].id,seat[14].name)">{{seat[14].name}}</div>
                <div class="seat"
                  [ngClass]="{'active-sold': checkSold(seat[15].id) , 'active-seat': checkActive(seat[15].id) }"
                  (click)="addSeat($event.target,seat[15].id,seat[15].name)">{{seat[15].name}}</div>
              </div>
            </div>
          </div>
          <!-- active-sold -->
        </div>
        <!-- Book food -->
        <div class="book-food" style="display: none;">
          <table class="tb-food table">
            <tr>
              <th class="text-start" style="padding: 15px;">COMBO</th>
              <th class="text-right">GIÁ</th>
              <th class="text-right">SỐ LƯỢNG</th>
            </tr>
            <tr class="thum-combo">
              <td colspan="3" style="padding: 15px;">COMBO</td>
            </tr>
            <tr *ngFor="let food of foodList; let i = index">
              <td class="text-start">
                <p class="head">{{food?.title}}</p>
                <p class="sub">{{food?.description}}</p>
              </td>
              <td class="text-right">
                <div>
                  <p class="price">{{food?.price | number:'1.0-0'}}</p>
                </div>
              </td>
              <td class="text-right">
                <div class="plus-minus">
                  <span (click)="minusFood(food?.id,food?.price)" class="minus">-</span>
                  <input disabled class="num" type="text" value="{{getValue(food?.id)}}" />
                  <span class="plus" (click)="plusFood(food?.id,food?.price)">+</span>
                </div>
              </td>

          </table>
        </div>
        <!-- Payment -->
        <div class="step-payment" style="display: none;">
          <div class="order-summary">
            <table class="tb-pay table ">
              <tr class="thum-combo">
                <td colspan="3" class="pay-sum" style="border-top: 0px; padding: 15px;">Tóm tắt theo thứ tự</td>
              </tr>
              <tr>
                <th class="text-start">MÔ TẢ</th>
                <th class="text-right">SỐ LƯỢNG</th>
                <th class="text-right">THÀNH TIỀN</th>
              </tr>
              <tr>
                <td class="text-start">
                  <p class="chair-pay">Ghế đơn</p>
                </td>
                <td class="text-right">
                  <p style="padding-right: 18px;">{{ bookingDTO?.seatId?.length }}</p>
                </td>
                <td class="text-right" style="padding-right: 40px;">
                  <p class="price">{{ bookingDTO?.seatId?.length * 50000 | number:'1.0-0' }}</p>
                </td>
              </tr>
              <tr *ngFor="let food1 of foodShow; let i = index">
                <td class="text-start">
                  <p class="food-water">{{food1?.title}}</p>
                </td>
                <td class="text-right">
                  <p style="padding-right: 18px;">{{food1?.quantity}}</p>
                </td>
                <td class="text-right" style="padding-right: 40px;">
                  <p class="price">{{food1?.quantity * food1?.price | number:'1.0-0'}}</p>
                </td>
              </tr>
              <tr>
                <td colspan="2" class="text-start">
                  <p class="total-pay">Total</p>
                </td>

                <td class="text-right" style="padding-right: 40px;">
                  <p class="price">{{bookingDTO?.totalPrice | number:'1.0-0' }}</p>
                </td>
              </tr>

            </table>
          </div>
          <!-- Select payment -->
          <div class="payment-ticket">
            <div class="card">
              <div class="card-header">
                <span class="pay-sum">
                  Payments</span>
              </div>

            </div>
          </div>
          <!-- Infomation -->
        </div>
      </div>
      <div class="col-md-4">
        <div class="info-ticket">
          <div class="info">
            <div class="event-name">{{bookingDTO?.movieName}}</div>
            <div class="location">Starlight Da Nang</div>
            <div class="date-time">Giờ chiếu {{bookingDTO?.showtime}} - {{bookingDTO?.showDate | date: 'dd/MM/yyyy'}}
            </div>
            <div class="room-seat">Màn hình {{movieShowtime?.screen.id}} - Ghế ngồi <span
                class="select-chair">{{seatContext}}</span></div>
          </div>
          <div class="total">
            <div class="total-chair">
              <span>TỔNG ĐƠN HÀNG</span>
              <p class="total-price">{{bookingDTO?.totalPrice | number:'1.0-0'}}</p>
            </div>
            <div class="time-chair">
              <span>THỜI GIAN GIAO DỊCH</span>
              <p>{{getDuration(bookingDTO?.dayTimeCookie)}}</p>
            </div>
          </div>
          <div class="description" style="display: none;">
            <p>Vé đã mua không được đổi hoặc hoàn tiền.</p>
            <p>Mã vé sẽ được gửi <b>01</b> lần qua số điện thoại và email đã nhập. Vui lòng
              kiểm tra lại thông tin trước khi tiếp tục.</p>
          </div>
          <div style="display: flex;">
            <div (click)="updateValueCookie1()" class="btun btn-back" style="background-color: blueviolet; flex: 30%;margin-right: 20px;">Quay lại</div>
            <div class="btun btn-next" (click)="updateValueCookie()">Tiếp tục</div>
          
            <div (click)="showInfoBooking()" class="btun btn-pay" style="display: none;">Thanh toán
          </div>
          </div>
        </div>
      </div>
    </div>
    <div class="wrapper qr-success" style="display: none;">
      <div class="container" style="margin-top: 20px;">
        <div class="row-book">
          <div class="col-md-3" style="border: 1px solid rgb(242 230 237);">
            <div class="payment-title">
              <h1>Thông tin vé</h1>
            </div>
            <div class="payment-detail">
              <div class="box-detail">
                <h4>
                  <p>Rạp</p>
                </h4>
                <div class="two-box">
                  <p class="merchant-name" style="font-weight: 400;">Starlight Da Nang</p>
                </div>
              </div>

              <div class="line-detail"></div>
              <div class="box-detail">
                <h4>
                  <p>Phim</p>
                </h4>
                <p style="font-weight: 400;">
                  {{bookingDTO?.movieName}}</p>
              </div>
              <div class="line-detail"></div>
              <div class="box-detail">
                <h4>
                  <p>Giờ chiếu</p>
                </h4>
                <p style="font-weight: 400;">{{bookingDTO?.showtime}} - {{bookingDTO?.showDate | date: 'dd/MM/yyyy'}}
                </p>
              </div>
              <div class="line-detail"></div>
              <div class="box-detail">
                <h4>
                  <p>Ghế</p>
                </h4>
                <p style="font-weight: 400;">
                  {{seatContext}}</p>
              </div>
              <div class="line-detail"></div>
              <div class="box-detail">
                <h4>
                  <p>Thông tin cá nhân</p>
                </h4>
                <div style="font-weight: 400;">
                  <div>{{account?.fullname}}</div>
                  <div>{{account?.email}}</div>
                  <div>{{account?.phone}}</div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-8">
            <div class="payment-content" id="body-payment-content">
              <div class="payment-qr col-sm-7 text-white">
                <div class="payment-cta p-0">
                  <div>
                    <h1>Xuất QR để vào cổng</h1>
                  </div>
                  <div class="qrcode_scan_container">
                    <div class="qrcode_scan">
                      <div class="qrcode_gradient">
                        <img alt="" src="../assets/images/payment/qrcode-gradient.png" loading="lazy"
                          class="jsx-d22f6bd0771ae323 img-fluid">
                      </div>
                      <div class="qrcode_border">
                        <img alt="" src="https://static.mservice.io/jk/momo2020/img/qrcode/border-qrcode.svg"
                          class="jsx-d22f6bd0771ae323 img-fluid">
                      </div>
                      <div *ngIf="urlQrCode" class="qrcode_image">
                        <img src="{{urlQrCode}}" class="image-qr-code" alt="">
                      </div>
                    </div>
                  </div>
                  <div class="" style="margin-top: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" width="16" viewBox="0 0 24 24"
                      stroke="currentColor" class="jsx-d22f6bd0771ae323 mr-1 inline h-6 w-6">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"
                        class="jsx-d22f6bd0771ae323"></path>
                    </svg>
                  </div>

                  <div class="text-center  d-flex" style="justify-content: center;">
                    <div class="mr-1 d-inline">Gặp khó khăn? </div>
                    <a class="text-yellow font-weight-bold-600 hover-none-decoration" href="#">Xem Hướng
                      dẫn</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div style="text-align: right;">
        <a class="btn " routerLink="/home">
          Quay về</a>
      </div>
    </div>
  </div>

  <!-- modal payment -->
  <div (click)="handleOverlayClick()" class="overlay" style="display: none;"></div>
  <div class="modal-payment modal-wrap" style="display: none;     top: 45%;">
    <div class="modal-header">
      <h4 class="title">Xác nhận đơn hàng</h4>
      <div (click)="handleOverlayClick()" class="cls" style="top: 20px;">
        <i class="fa-solid fa-xmark"></i>
      </div>
    </div>
    <div class="modal-body">
      <div>
        <div>Rạp</div>
        <div>Da Nang</div>
      </div>
      <div>
        <div>Phim</div>
        <div>{{bookingDTO?.movieName}}</div>
      </div>
      <div>
        <div>Giờ chiếu</div>
        <div><b>{{bookingDTO?.showtime | slice:0:5}}</b> <b> {{ bookingDTO?.showDate | date}}</b></div>
      </div>
      <div>
        <div>Ghế</div>
        <div>{{seatContext}}</div>
      </div>
      <div>
        <div>Thông tin cá nhân</div>
        <div>
          <p>{{account?.fullname}}</p>
          <p>{{account?.email}}</p>
          <p>{{account?.phone}}</p>
        </div>
      </div>
      <div>
        <div>Hình thức thanh toán</div>
        <div>Paypal</div>
      </div>
    </div>
    <div class="modal-footer">
      <br>
      <ngx-paypal style="width: 100%;" [config]="payPalConfig"></ngx-paypal>
    </div>
  </div>

</div>


<!-- Modal Re-buy -->
<div class="modal-wrap modal-rebuy" style="display: none;">
  <div class="modal-header">
    <div class="cls">
    </div>
  </div>
  <div class="modal-body" style="padding-top: 30px;">
    Hết thời gian đặt vé, Vui lòng thực hiện lại
  </div>
  <div class="modal-footer">
    <button type="button" class="btn-rebuy"><a routerLink="/home" style="color: #fff;">Đặt lại vé</a></button>
  </div>
</div>

<!-- Modal max chair -->
<div class="modal-wrap modal-maxchair" #modalMaxchair style="display: none;">
  <div class="modal-header">
    <div (click)="closeModal()" class="cls" style="padding-top: 5px;">
      <i class="fa-solid fa-xmark"></i>
    </div>
  </div>
  <div class="modal-body" style="padding-top: 30px;">
    Chỉ cho phép đặt tối đa 5 ghế
  </div>
  <div class="modal-footer">
    <button (click)="closeModal()" type="button" class="btn-cls">Đóng</button>
  </div>
</div>

<canvas style="display: none;" #qrCanvas></canvas>